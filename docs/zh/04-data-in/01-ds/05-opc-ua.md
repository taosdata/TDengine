---
sidebar_label: OPC UA
title: “OPC UA”数据源
description: 使用“OPC UA”数据源导入数据到 TDengine Cloud 的实例
---

OPC UA 数据写入，是通过连接代理把数据从 OPC UA 系统写入到当前选择的 TDengine Cloud 实例。

:::note 非常重要

首次创建 OPC UA 数据源会在当前实例选择的价格方案上面产生额外费用。更多信息，请[联系咨询](https://cloud.taosdata.com)。

:::

## 先决条件

- 创建一个空数据库来存储 OPC UA 数据。更多信息，请参阅 [数据库](../../../programming/model/#create-database)。
- 确保连接代理运行在与 OPC UA 服务器位于同一网络的机器上。更多信息，请参阅 [安装连接代理](../install-agent/)。

## 具体步骤

1. 在 TDengine Cloud 中，在左边菜单中打开 **数据写入** 页面，在 **数据源** 选项卡上，单击 **添加数据源**打开新增页面。在**名称**输入框里面填写这个数据源的名称，并选择 **OPC-UA** 类型，在**代理**选择框里面选择已经创建的代理，如果没有创建代理，请点击旁边的**创建新的代理**按钮去创建新代理。
2. 在**目标数据库**里面选择一个当前所在的 TDengine Cloud 实例里面的数据库作为目标数据库。
3. 在**服务地址**栏，需要配置 OPC UA 服务器的地址，输入格式为 127.0.0.1:6666/OPCUA/ServerPath。
4. 在**认证**栏，选择访问方式。可以选择匿名访问、用户名密码访问、证书访问。使用证书访问时，需配置证书文件信息、私钥文件信息、OPC-UA 安全协议和 OPC-UA 安全策略。
5. 可以点击**连通性检查**, 检查 Cloud 实例 与 OPC UA 服务之间是否可以连通。
6. 在**点位集**栏，配置是否启用点位配置文件。如果启用，请复制 CSV 配置文件的具体内容配置点位信息，而且**点位集**与**库表配置**将不再生效。详细的 CSV 配置，请查看[CSV 详细配置](#csv-详细配置).
7. 在**采集配置**栏，配置采集间隔（单位：秒）、点位数量、采集模式。采集模式可选择 observe（轮询模式）和 subscribe（订阅模式），默认值为 subscribe。
8. 在**库表配置**栏，配置目标 TDengine 中存储数据的超级表、子表结构信息。
9. 在**高级选项**栏，配置最大写入并发数、单次采集上报批次（默认值 1000）、批次延时（单位：秒，默认值 1）、选择日志级别，在**原始数据保存**栏，配置是否启用保存。如果保存，请设置保存路径和具体保存天数。
10. 填写完成以上信息后，点击**新增**按钮，即可直接启动从 OPC UA 服务器到 TDengine Cloud 实例的数据同步。

## CSV 详细配置

下面的表格描述了 OPC UA 的 CSV 配置里面每个列的名称，格式，必要性和详细描述。客户可以根据自己的实际需要创建相应的 CSV 配置文件。

| 名称             | 格式              | 必要性 | 描述                                                                                                                                                                                                    |
| :--------------- | :---------------- | :----: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 测点 ID          | point_id          |   是   | OPC-UA 节点 ID。                                                                                                                                                                                        |
| 数据类型         | type              |   是   | 目前节点的类型，类型可以是 int，double 或者其他 TDengine 数据类型。                                                                                                                                     |
| 超级表名称       | stable            |   否   | 默认的模板格式是“opc\_\{type}”。为了更好使用，鼓励客户定义自己的超级表名称规则。                                                                                                                        |
| 子表名称         | tbname            |   是   | 子表名称，该表是某个超级表下面的子表。                                                                                                                                                                  |
| 可更新           | enabled           |   否   | 是否更新这个节点，默认值是`true`。                                                                                                                                                                      |
| 时间戳列名称     | ts_col            |   否   | 使用 OPC 消息时间作为主时间戳值。默认是 OPC 消息的内建时间戳。                                                                                                                                          |
| 接收时间戳列名称 | received_time_col |   否   | 使用 taosx 收集时间作为主时间戳值。如果同时定义 ts_col 和 received_time_col，received_time_col 将会被用作时间戳索引。                                                                                   |
| 值列名           | value_col         |   否   | 在一个超级表下面的每个节点的值的列名称。                                                                                                                                                                |
| 量列名           | quality_col       |   否   | 在一个超级表下面的每个节点的量的列名称，类似于值列名。                                                                                                                                                  |
| 额外标签         | tag::type::name   |   否   | 标签定义，“tag”是标识前缀，“type”是 TDengine 数据类型，经常使用 VARCHAR 作为字符串类型，“name”是超级表的标签名称。一个完整的字符串示例如：tag::varchar(64)::note。您可以添加更多的标签如果您愿意的话。 |

:::note 非常重要

1. 推荐对于不同的数据类型使用不同的超级表名称。
2. 推荐每个节点使用不同的子表名称。
3. 推荐使用接收时间戳作为主时间戳。

:::
