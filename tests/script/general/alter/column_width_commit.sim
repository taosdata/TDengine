system sh/stop_dnodes.sh

system sh/deploy.sh -n dnode1 -i 1
system sh/cfg.sh -n dnode1 -c wallevel -v 2
system sh/exec.sh -n dnode1 -s start

sleep 2000
sql connect

print ======== step1 create db 
sql drop database if exists db1;
sql CREATE DATABASE db1;
sql use db1;

print ======== step2 create normal table  
sql CREATE TABLE normal_t1('ts' TIMESTAMP, 'c1' BINARY(1));

print ======== step3 alter column width 
sql alter table db1.normal_t1 modify column c1 binary(2400);

print ======== step4 insert into 20 rows
$ms = 0
$cnt = 0
while $cnt < 20
   $ms = $cnt . m
   sql insert into normal_t1(ts,c1) values(now + $ms , '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'); 
   $cnt = $cnt + 1
 endw  

########################################################
print ===> step 4 stop dnode1
system sh/exec.sh -n dnode1 -s stop -x SIGINT

########################################################
print ===> step 5 start dnode1
system sh/exec.sh -n dnode1 -s start

sleep 1000

sql select count(*) from db1.normal_t1;
print $data00
if $rows != 1 then
  return -1
endi
if $data00 != 20 then
  return -1
endi


system sh/exec.sh -n dnode1 -s stop -x SIGINT
