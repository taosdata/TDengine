FROM tdgpt_env:1.1 AS tdgpt
WORKDIR /root
ENV DEBIAN_FRONTEND=noninteractive
ARG pkgFile
ARG dirName
ARG modelDlUrl

COPY ${modelDlUrl}/tdtsfm/taos.pth /var/lib/taos/taosanode/model/tdtsfm/
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh
ADD ${pkgFile} /root/
ENV INSTALL_VENV=False
RUN cd ${dirName}/ && \
    /bin/bash install.sh -e no && \
    cd .. && \
    rm -rf ${dirName}
EXPOSE 6035 8387 6036 6037 6038 6039 6061
ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]


FROM tdgpt AS tdgpt_full
COPY ${modelDlUrl}/timemoe/* \
    /var/lib/taos/taosanode/model/timemoe/

COPY ${modelDlUrl}/moment/* \
    /var/lib/taos/taosanode/model/moment/