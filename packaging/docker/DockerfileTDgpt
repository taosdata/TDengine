FROM tdgpt_env:1.1 AS tdgpt_lite
WORKDIR /root
ENV DEBIAN_FRONTEND=noninteractive
ARG pkgFile
ARG dirName
ARG modelDlUrl

ADD ${pkgFile} \
    ${modelDlUrl}/fc_australia.sql \
    /root/

RUN cd ${dirName}/ && \
    /bin/bash install.sh -e no && \
    cd .. && \
    rm -rf ${dirName}
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh
EXPOSE 6090 8387 5000
ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]

FROM tdgpt_lite AS tdgpt

ADD ${modelDlUrl}/taos.pth \
    ${modelDlUrl}/tdtsfm-server.py \
    /usr/local/taos/taosanode/model/tdtsfm/

FROM tdgpt AS tdgpt_full
ADD ${modelDlUrl}/time-moe/models \
    ${modelDlUrl}/time-moe/timemoe-server.py \
    /usr/local/taos/taosanode/model/time-moe/
